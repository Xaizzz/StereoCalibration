# Архитектурная диаграмма Stereo Calibration

## Обзор слоев архитектуры

```
┌─────────────────────────────────────────────────────────────┐
│                        UI LAYER                             │
│  ┌─────────────────────┐    ┌─────────────────────────────┐ │
│  │ CameraSelectionForm │    │        MainForm             │ │
│  │   (только UI)       │    │     (только UI)             │ │
│  └─────────────────────┘    └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                    PRESENTER LAYER                          │
│  ┌─────────────────────┐    ┌─────────────────────────────┐ │
│  │CameraSelectionPrese │    │   MainFormPresenter         │ │
│  │nter (MVP Pattern)   │    │   (MVP Pattern)             │ │
│  └─────────────────────┘    └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   INTERFACE LAYER                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ICameraServi │  │ICalibration │  │IArUcoDetectionServi │ │
│  │ce           │  │Service      │  │ce                   │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│  ┌─────────────┐  ┌─────────────────────────────────────┐ │
│  │ITriangulati │  │          IFileService               │ │
│  │onService    │  │                                     │ │
│  └─────────────┘  └─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                   SERVICE LAYER                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │CameraServic │  │Calibration  │  │ArUcoDetectionServic │ │
│  │e            │  │Service      │  │e                    │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│  ┌─────────────┐  ┌─────────────────────────────────────┐ │
│  │Triangulatio │  │          FileService                │ │
│  │nService     │  │                                     │ │
│  └─────────────┘  └─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                     MODEL LAYER                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │CameraInfo   │  │Calibration  │  │MarkerDetectionResul │ │
│  │             │  │Result       │  │t                    │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│  ┌─────────────────────────────────────────────────────┐ │
│  │               StereoFrame                           │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────┐
│                 EXTERNAL DEPENDENCIES                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │   OpenCV    │  │ Newtonsoft  │  │    System.IO        │ │
│  │   Sharp     │  │    Json     │  │                     │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## Поток данных

```
User Interaction → UI Forms → Presenters → Services → Models → External APIs
     ↑                                                              ↓
     └────────────────── Events/Callbacks ←────────────────────────┘
```

## Взаимодействие компонентов

### Инициализация приложения

```
1. Program.cs → MainForm
2. MainForm → MainFormPresenter (DI)
3. MainFormPresenter → Services (DI)
4. Services → External Dependencies
```

### Рабочий процесс калибровки

```
1. User Input → MainForm
2. MainForm → MainFormPresenter.CaptureImagePair()
3. MainFormPresenter → CameraService.GetCurrentFrame()
4. MainFormPresenter → CalibrationService.FindChessboardCorners()
5. MainFormPresenter → FileService.SaveImageAsync()
6. Data Collection Complete → CalibrationService.PerformStereoCalibration()
7. Results → CalibrationResult Model
8. Results → UI Update via Events
```

## Принципы SOLID в диаграмме

### Single Responsibility Principle (SRP)

- Каждый слой имеет единственную ответственность
- UI отвечает только за отображение
- Сервисы - только за бизнес-логику
- Модели - только за данные

### Open/Closed Principle (OCP)

- Интерфейсы позволяют расширение без модификации
- Новые сервисы можно добавить через интерфейсы
- Новые алгоритмы калибровки легко интегрируются

### Liskov Substitution Principle (LSP)

- Любая реализация интерфейса взаимозаменяема
- Тестовые моки могут заменить реальные сервисы

### Interface Segregation Principle (ISP)

- Клиенты зависят только от нужных интерфейсов
- Мелкие специализированные интерфейсы

### Dependency Inversion Principle (DIP)

- Презентеры зависят от абстракций (интерфейсов)
- Конкретные реализации внедряются через DI
- Обращение зависимостей: высокоуровневые модули не зависят от низкоуровневых
